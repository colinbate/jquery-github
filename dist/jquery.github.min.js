/*
 *  jQuery Github - v0.4.0
 *  A jQuery plugin to display your Github and Bitbucket Repositories.
 *  https://github.com/zenorocha/jquery-github/
 *
 *  Copyright (c) 2013
 *  MIT License
 */
function GithubRepo(a){this.description=a.description,this.forks=a.forks,this.name=a.name,this.open_issues=a.open_issues,this.pushed_at=a.pushed_at,this.url=a.url,this.watchers=a.watchers,this.branch=a.branch||"master",this.download_url=a.download_url||"/zipball/master",this.watchers_url=a.watchers_url||"/watchers",this.forks_url=a.forks_frag||"/network",this.issues_url=a.issues_url||"/issues"}function BitbucketRepo(a){var b,c={};return c.description=a.description,c.forks=a.forks_count,c.name=a.name,a.logo&&(c.name='<img height="16" width="16" src="'+a.logo+'"> '+a.name),c.open_issues=0,c.pushed_at=a.utc_last_updated,c.url="https://bitbucket.org/"+a.resource_uri.replace("/1.0/repositories/",""),c.watchers=a.followers_count,c.download_url="/get/default.zip",c.watchers_url="/follow",c.forks_frag="/fork",c.branch="default",b=new GithubRepo(c),b._parseURL=function(a){return a},b}function Github(a,b){var c=this,d={iconStars:!0,iconForks:!0,iconIssues:!1};c.element=a,c.$container=$(a),c.repo=c.$container.attr("data-repo"),c.type="Github",c.options=$.extend({},d,b),c._defaults=d,c.init()}GithubRepo.prototype.toHTML=function(){var a=this;return a.pushed_at=a._parsePushedDate(a.pushed_at),a.url=a._parseURL(a.url),$("<div class='github-box'><div class='github-box-header'><h3><a href='"+a.url+"'>"+a.name+"</a></h3><div class='github-stats'><a class='repo-stars' title='Stars' data-icon='7' href='"+a.url+a.watchers_url+"'>"+a.watchers+"</a><a class='repo-forks' title='Forks' data-icon='f' href='"+a.url+a.forks_url+"'>"+a.forks+"</a><a class='repo-issues' title='Issues' data-icon='i' href='"+a.url+a.issues_url+"'>"+a.open_issues+"</a></div></div><div class='github-box-content'><p>"+a.description+" &mdash; <a href='"+a.url+"#readme'>Read More</a></p></div><div class='github-box-download'><p class='repo-update'>Latest commit to <strong>"+a.branch+"</strong> on "+a.pushed_at+"</p><a class='repo-download' title='Download as zip' data-icon='w' href='"+a.url+a.download_url+"'></a></div></div>")},GithubRepo.prototype._parsePushedDate=function(a){var b=new Date(a);return b.getDate()+"/"+(b.getMonth()+1)+"/"+b.getFullYear()},GithubRepo.prototype._parseURL=function(a){return a.replace("api.","").replace("repos/","")},Github.prototype.init=function(){var a=this,b=a.getCache();"bb:"===a.repo.substr(0,3)&&(a.type="Bitbucket",a.options.iconIssues=!1,a.repoFactory=function(a){return new BitbucketRepo(a)},a.repo=a.repo.substr(3)),"gh:"===a.repo.substr(0,3)&&(a.repo=a.repo.substr(3)),null!==b?a.applyTemplate(JSON.parse(b)):a.requestData(a.repo)},Github.prototype.displayIcons=function(){$iconStars=$(".repo-stars"),$iconForks=$(".repo-forks"),$iconIssues=$(".repo-issues"),this.options.iconStars?$iconStars.css("display","inline-block"):$iconStars.css("display","none"),this.options.iconForks?$iconForks.css("display","inline-block"):$iconForks.css("display","none"),this.options.iconIssues?$iconIssues.css("display","inline-block"):$iconIssues.css("display","none")},Github.prototype.requestData=function(a){var b="get"+this.type;this[b].apply(this,[a])},Github.prototype.handleErrorRequest=function(a){console.warn(a.message)},Github.prototype.handleSuccessfulRequest=function(a){var b=this;b.applyTemplate(a),b.setCache(a)},Github.prototype.setCache=function(a){var b=this;window.sessionStorage&&window.sessionStorage.setItem("gh-repos:"+b.repo,JSON.stringify(a))},Github.prototype.getCache=function(){var a=this;return window.sessionStorage?window.sessionStorage.getItem("gh-repos:"+a.repo):!1},Github.prototype.applyTemplate=function(a){var b=this,c="function"==typeof b.repoFactory?b.repoFactory(a):new GithubRepo(a),d=c.toHTML();d.appendTo(b.$container),b.displayIcons()},Github.prototype.getGithub=function(a){var b=this;$.ajax({url:"https://api.github.com/repos/"+a,dataType:"jsonp",success:function(a){var c=a.data;a.meta.status>=400&&c.message?b.handleErrorRequest(c):b.handleSuccessfulRequest(c)}})},Github.prototype.getBitbucket=function(a){var b=this;$.ajax({url:"https://bitbucket.org/api/1.0/repositories/"+a,dataType:"jsonp",success:function(a){var c=a;c.error?b.handleErrorRequest(c.error):b.handleSuccessfulRequest(c)}})},function(a){a.fn.github=function(b){return this.each(function(){a(this).data("plugin_github")||a(this).data("plugin_github",new Github(this,b))})}}(window.jQuery||window.Zepto,window);